<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LinkaVel Card Game</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="deck_builder.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="app-container">

        <div id="menu-screen" class="screen active">
            <div class="menu-header">
                <h1 class="game-title">LinkaVel</h1>
                <p class="game-subtitle">Card Game</p>
            </div>

            <div class="menu-options">
                <button class="menu-btn" onclick="startSinglePlay()">
                    <span class="btn-icon">üë§</span>
                    <span class="btn-text">SOLO MODE - <small>CPUÂØæÊà¶</small></span>
                </button>
                <button class="menu-btn disabled">
                    <span class="btn-icon">üåê</span>
                    <span class="btn-text">ROOM MATCH - <small>ËøëÊó•ÂÖ¨Èñã</small></span>
                </button>
                <button class="menu-btn" onclick="openDeckEditor()">
                    <span class="btn-icon">üÉè</span>
                    <span class="btn-text">DECK BUILD - <small>„Éá„ÉÉ„Ç≠Á∑®Êàê</small></span>
                </button>
            </div>

            <div class="menu-footer">
                <span id="user-status">Guest Mode</span>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div id="game-viewport">

                <div id="ui-layer" class="safe-area">

                    <div id="hud-player-status" class="hud-stats ply">
                        <div class="hud-label">YOU</div>
                        <div class="hud-lp" id="player-lp-hud">5000</div>
                    </div>


                    <div id="hud-opponent-status" class="hud-stats opt">
                        <div class="hud-label">OPPONENT</div>
                        <div class="hud-lp" id="opponent-lp-hud">5000</div>
                        <div class="hud-sub">HAND: <span id="opt-hand-hud">5</span></div>
                    </div>

                    <div id="card-info-panel">

                        <div id="info-visual-container"></div>


                        <div id="info-text-container">
                            <div class="info-header">
                                <span id="info-name">No Selection</span>
                                <span id="info-attr"></span>
                            </div>
                            <div class="info-body">
                                <div id="info-stats">
                                    <div id="info-main-stats">
                                        <span id="info-level"></span>
                                        <span id="info-power"></span>
                                    </div>
                                    <div id="info-extra-stats"></div>
                                </div>
                                <div id="info-text">„Ç´„Éº„Éâ„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫</div>
                            </div>
                        </div>
                    </div>

                    <div id="floating-action-container"></div>

                    <button id="next-phase-btn">
                        <span class="btn-sub">GO TO</span>
                        <span id="next-phase-display">MAIN1</span>
                    </button>

                    <button id="surrender-btn">ÈôçÂèÇ</button>
                </div>

                <div id="field-perspective-wrapper">
                    <div id="field-surface">
                        <div class="field-half opponent-field">
                            <div class="field-row back-row">
                                <div class="zone trash-zone" id="opponent-trash-zone" onclick="openTrashViewer('opponent')"><span id="opt-trash-count-badge">0</span></div>
                                <div class="zone magic-zone" id="opt-magic-2"></div>
                                <div class="zone magic-zone" id="opt-magic-1"></div>
                                <div class="zone magic-zone" id="opt-magic-0"></div>
                                <div class="zone empty-zone"></div>
                            </div>
                            <div class="field-row front-row">
                                <div class="zone deck-zone" id="opponent-deck-zone"><span id="opt-deck-count">20</span></div>
                                <div class="zone monster-zone" id="opt-monster-2"></div>
                                <div class="zone monster-zone" id="opt-monster-1"></div>
                                <div class="zone monster-zone" id="opt-monster-0"></div>
                                <div class="zone empty-zone"></div>
                            </div>
                        </div>

                        <div class="field-gap">
                            <div id="phase-center-label">DRAW PHASE</div>
                        </div>

                        <div class="field-half player-field">
                            <div class="field-row front-row">
                                <div class="zone empty-zone"></div>
                                <div class="zone monster-zone" data-index="0" id="ply-monster-0"></div>
                                <div class="zone monster-zone" data-index="1" id="ply-monster-1"></div>
                                <div class="zone monster-zone" data-index="2" id="ply-monster-2"></div>
                                <div class="zone deck-zone" id="player-deck-zone">
                                    <span id="ply-deck-count-badge">20</span>
                                </div>
                            </div>
                            <div class="field-row back-row">
                                <div class="zone empty-zone"></div>
                                <div class="zone magic-zone" data-index="0" id="ply-magic-0"></div>
                                <div class="zone magic-zone" data-index="1" id="ply-magic-1"></div>
                                <div class="zone magic-zone" data-index="2" id="ply-magic-2"></div>
                                <div class="zone trash-zone" id="player-trash-zone" onclick="openTrashViewer('player')"><span id="ply-trash-count-badge">0</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="player-hand-container">
                    <div id="player-hand"></div>
                </div>
            </div>



            <div id="game-start-overlay">
                <div class="start-modal-content">
                    <h2 id="start-title">DUEL</h2>
                    <p id="start-message">Ê∫ñÂÇô‰∏≠...</p>
                    <button class="start-btn" onclick="beginDuel()">START</button>
                </div>
            </div>

            <div id="game-result-overlay">
                <div class="result-modal-content">
                    <h2 id="result-title">VICTORY</h2>
                    <p id="result-message">Áõ∏Êâã„ÅÆLP„Çí0„Å´„Åó„Åæ„Åó„Åü</p>
                    <button class="result-home-btn" onclick="backToMenu()">HOME„Å´Êàª„Çã</button>
                </div>
            </div>


            <div id="trash-viewer-modal" class="modal-overlay" onclick="closeTrashViewer()">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <div id="trash-viewer-header">
                        <span id="trash-viewer-title">„Éà„É©„ÉÉ„Ç∑„É•</span>
                        <button class="modal-close-btn" onclick="closeTrashViewer()">√ó</button>
                    </div>
                    <div id="trash-card-list"></div>
                </div>
            </div>


            <div id="selection-modal" class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <span id="selection-title">Êç®„Å¶„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû</span>
                    </div>
                    <div id="selection-card-list" class="horizontal-list"></div>
                    <div class="modal-footer">
                        <button id="selection-confirm-btn" class="menu-btn disabled">Á¢∫ÂÆö (ÊÆã„Çä <span id="selection-needed-count">0</span>Êûö)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="deck-select-screen" class="screen">
            <div class="menu-header">
                <h1 class="game-title">Deck Select</h1>
                <p class="game-subtitle">‰ΩøÁî®„Åô„Çã„Éá„ÉÉ„Ç≠„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
            </div>
            <div id="deck-list-container" class="menu-options">

            </div>
            <div class="menu-footer">
                <button class="menu-btn" onclick="backToMenu()">BACK</button>
            </div>
        </div>


        <div id="common-confirm-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <span id="common-confirm-title" style="color:var(--accent-blue); font-weight:bold;">Á¢∫Ë™ç</span>
                </div>
                <div id="common-confirm-message" style="padding: 20px 0; color: #fff;"></div>
                <div class="modal-footer" style="display:flex; gap:10px; justify-content:center;">
                    <button id="common-confirm-cancel" class="menu-btn" style="flex:1;">„ÅÑ„ÅÑ„Åà</button>
                    <button id="common-confirm-ok" class="menu-btn" style="flex:1; border-color: var(--accent-blue); color: var(--accent-blue);">„ÅØ„ÅÑ</button>
                </div>
            </div>
        </div>

        <div id="deck-screen" class="screen">
            <div id="deck-builder-view">
                <!-- Header -->
                <div class="builder-header">
                    <div class="header-actions">
                        <button id="builder-back-btn" class="builder-btn">BACK</button>
                        <input type="text" id="builder-deck-name" class="deck-name-input" placeholder="„Éá„ÉÉ„Ç≠Âêç">
                    </div>
                    <div class="header-actions">
                        <span id="deck-count-indicator" class="deck-count-indicator">0 / 30</span>
                        <button id="builder-save-btn" class="builder-btn save" disabled>SAVE</button>
                    </div>
                </div>

                <!-- Current Deck Area -->
                <div class="current-deck-area">
                    <div class="deck-stats-bar">
                        <span>Main Deck</span>
                        <span>Monster: <span id="stat-monster">0</span> / Magic: <span id="stat-magic">0</span></span>
                    </div>
                    <div id="builder-deck-grid" class="deck-grid-scroll"></div>
                </div>

                <!-- Detail Area -->
                <div class="builder-detail-area">
                    <div id="detail-img-box" class="detail-img-box"></div>
                    <div id="detail-info-box" class="detail-info-box">
                        <div style="color:#666; display:flex; align-items:center; justify-content:center; height:100%;">„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    </div>
                    <div id="detail-actions" class="detail-actions" style="display:none;">
                        <button id="btn-add-card" class="action-btn add">+</button>
                        <button id="btn-remove-card" class="action-btn remove">-</button>
                    </div>
                </div>

                <!-- Library Area -->
                <div class="library-area">
                    <div class="library-filter-bar">
                        <select id="filter-attr" class="filter-select">
                            <option value="all">ÂÖ®Â±ûÊÄß</option>
                            <option value="ÁÅ´">ÁÅ´</option>
                            <option value="Ê∞¥">Ê∞¥</option>
                            <option value="Ëçâ">Ëçâ</option>
                            <option value="ÂÖâ">ÂÖâ</option>
                            <option value="Èóá">Èóá</option>
                            <option value="ÁÑ°">ÁÑ°</option>
                        </select>
                        <select id="filter-level" class="filter-select">
                            <option value="all">ÂÖ®„É¨„Éô„É´</option>
                            <option value="1">Lv.1</option>
                            <option value="2">Lv.2</option>
                            <option value="3">Lv.3</option>
                            <option value="4">Lv.4</option>
                        </select>
                        <select id="filter-type" class="filter-select">
                            <option value="all">ÂÖ®Á®ÆÂà•</option>
                            <option value="monster">„É¢„É≥„Çπ„Çø„Éº</option>
                            <option value="magic">È≠îË°ì</option>
                        </select>
                    </div>
                    <div id="builder-library-grid" class="library-grid"></div>
                </div>

                <!-- Toast -->
                <div id="builder-toast"></div>
            </div>
        </div>

    </div>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase_config.js"></script>

    <script src="cards.js"></script>
    <script src="deck_builder.js"></script>
    <script src="effect_logic.js"></script>
    <script src="main.js"></script>
    <script src="cpu_logic.js"></script>
</body>
</html>
